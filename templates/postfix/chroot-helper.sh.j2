#!/bin/bash
############################################################################
########### Managed by ansible (role: mailserver), do not edit! ############
############################################################################

# Add some files to postfix's chroot
CHROOT=/var/spool/postfix
if [ -d "${CHROOT}" ] ; then
    mkdir -p "${CHROOT}"
fi

{% if mailserver_ldap_cert_file is defined %}
export CAFILEPATH="$(dirname {{ mailserver_ldap_cert_file }})"
echo "CA file is in $CAFILEPATH"
mkdir -p "${CHROOT}${CAFILEPATH}" || /bin/true
cp "{{ mailserver_ldap_cert_file }}" "${CHROOT}/{{ mailserver_ldap_cert_file }}" || /bin/true
{% endif %}

{% if mailserver_postfix_sasl_bind %}
mkdir -p "${CHROOT}/run/postfix" || /bin/true
mount --bind /run/postfix "${CHROOT}/run/postfix" || /bin/true
{% endif %}
